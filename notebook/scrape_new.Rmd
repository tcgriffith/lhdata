---
title: "scrape_new"
author: "TC"
date: "November 6, 2017"
output: html_document
---

```{r setup, include=FALSE,message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(lubridate)
pkg_path="~/GIT/lhdata"
post_path="~/GIT/owaraisite/content/post/"

if (Sys.info()["sysname"]=="Windows"){
  pkg_path="c:/Users/TC/GIT/lhdata"
  post_path="c:/Users/TC/GIT/owaraisite/content/post/"
}

source(encoding="UTF-8",file=paste0(pkg_path,"/R/api_getuploads.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/api_getuploads_fp.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/getbangumi.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/getyearsdf.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/api_aid2cid.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/api_getbilitags.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/api_upload_imgur.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/generate_posts2.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/annotate_vlist_tmp.R"))
source(encoding="UTF-8",file=paste0(pkg_path,"/R/fromJSON_fix.R"))

# source(encoding="UTF-8",file=paste0(pkg_path,"/R/annotate_vlist.R"))
load(paste0(pkg_path,"/data/mid.rda"))

if (file.exists("/data/manual_filter.rda")){
  load(paste0(pkg_path,"/data/manual_filter.rda"))
}else {
  manual_filter=data.frame(aid=NA)
}
```





```{r test5, eval= FALSE}
# sclarkca_ 764931 字幕 


vlist.newm <-api_getuploads(764931,kw = "字幕")

# vlist.new <- vlist.new %>%
#   filter(grepl("ametalk|rahmens|speedwagon",title,ignore.case = TRUE))

vlist.newm$zmz="hitori字幕组"

p= list.files(post_path)
oldaid <- ((gsub('^.*-(.*).md$','\\1',p)))


vlist.new <- vlist.newm %>%
  filter(!aid %in% oldaid, !aid %in% manual_filter$aid)




```

```{r eval= FALSE}
# clos 385066467 字幕 


vlist.newm <-api_getuploads(385066467,kw = "字幕")

# vlist.new <- vlist.new %>%
#   filter(grepl("ametalk|rahmens|speedwagon",title,ignore.case = TRUE))

vlist.newm$zmz="冲绳六岁小女孩字幕组"

p= list.files(post_path)
oldaid <- ((gsub('^.*-(.*).md$','\\1',p)))


vlist.new <- vlist.newm %>%
  filter(!aid %in% oldaid, !aid %in% manual_filter$aid)


```


```{r}
vlist.fws = api_getuploads(381936)

sets = c("25742854", "25709229", "25667045", "25646859", "25623642", "25591161", "25584412", "25541196", "25529498", "25476848", "25249399", "17657597", "17482259", "17365385", "17194358", "17171414", "17152860")



```


```{r}
vlist.new = vlist.fws[which(vlist.fws$aid %in% sets),]

vlist.new$zmz="风物诗字幕组"

```




## add info

```{r}
## vlist add more columns using api
## require vlist.new
message("###########################################################")
message("...starting downloading pics\n")
#source("../R/annotate_vlist.R")
vlist.new.anno <-annotate_vlist(vlist.new)

generate_post2(vlist.new.anno,post_path)

```

## output

```{r}
message("###########################################################")
message("...starting generating pics")
message("###########################################################")

generate_post2(vlist.new.anno,post_path)
```
